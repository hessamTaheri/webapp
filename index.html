<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>اپلیکیشن شبیه‌ساز و تست کوررنگی</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="https://example.com/icon.png" sizes="192x192">
  <link rel="apple-touch-icon" href="https://example.com/icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#3B5998">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      margin: 0;
      padding: 0 15px;
      background: #E0E0E0;
      color: #333333;
      overflow: hidden;
      direction: rtl;
      touch-action: manipulation;
    }
    header, footer, aside, .site-header, .site-footer, .sidebar {
      display: none !important;
    }
    :root {
      --bg-color: #E0E0E0;
      --text-color: #333333;
      --secondary-text: #5D6D7E;
      --shadow-light: rgba(255, 255, 255, 0.7);
      --shadow-dark: rgba(0, 0, 0, 0.2);
      --primary-color: #3B5998;
      --primary-hover: #2A4373;
      --accent-color: #F5F5F5;
    }
    #app-home {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      padding: 20px 0;
      height: 100vh;
      overflow-y: auto;
      background: var(--bg-color);
      padding-right: 20px;
    }
    .app-icon {
      text-align: center;
      background: var(--bg-color);
      border-radius: 12px;
      padding: 20px 15px;
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      cursor: pointer;
      transition: all 0.3s ease;
      height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 5px 0;
    }
    .app-icon:hover {
      transform: translateY(-2px);
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
      background: linear-gradient(145deg, var(--bg-color), var(--accent-color));
    }
    .app-icon:active {
      box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
      transform: translateY(0);
      background: var(--bg-color);
    }
    .app-icon i {
      font-size: 40px;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    .app-icon:hover i, .app-icon:hover span {
      color: var(--primary-hover);
    }
    .app-icon span {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
    }
    .tool-page {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: var(--bg-color);
      padding: 15px;
      z-index: 10;
    }
    .tool-page.active {
      display: block;
    }
    .back-btn, button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: var(--bg-color);
      color: var(--text-color);
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
      transition: all 0.3s ease;
      margin: 5px 0;
    }
    .back-btn:hover, button:hover {
      background: linear-gradient(145deg, var(--bg-color), var(--accent-color));
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
      color: var(--primary-hover);
    }
    .back-btn:active, button:active {
      box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
      transform: translateY(2px);
      background: var(--bg-color);
    }
    .container {
      background: var(--bg-color);
      border-radius: 12px;
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      padding: 20px;
      max-width: 90%;
      margin: 15px auto;
      text-align: center;
    }
    .container,
    .quizContainer {
      margin-right: 20px;
    }
    .back-btn {
      margin-right: 20px;
    }
    h1, h2 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text-color);
    }
    .modes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
    }
    .modes label {
      font-size: 13px;
      cursor: pointer;
      padding: 8px 14px;
      background: var(--bg-color);
      border-radius: 20px;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
      transition: all 0.3s ease;
      color: var(--text-color);
    }
    .modes input[type="radio"] {
      display: none;
    }
    .modes input[type="radio"]:checked + span {
      background: linear-gradient(145deg, var(--bg-color), var(--accent-color));
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
      color: var(--primary-color);
      font-weight: bold;
    }
    .modes label span {
      transition: all 0.15s;
    }
    .modes label:active span {
      transform: scale(0.96);
      box-shadow: inset 3px 3px 8px var(--shadow-dark), inset -3px -3px 8px var(--shadow-light);
    }
    input[type="range"] {
      width: 100%;
      max-width: 180px;
      accent-color: var(--primary-color);
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(145deg, var(--shadow-dark), var(--shadow-light));
      cursor: pointer;
    }
    canvas {
      border: 1px solid var(--accent-color);
      width: 100%;
      height: auto;
      border-radius: 8px;
      max-width: 100%;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 8px;
      min-width: 200px;
      background: var(--bg-color);
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
      color: var(--text-color);
    }
    input[type="text"]::placeholder {
      color: var(--secondary-text);
    }
    iframe {
      width: 100%;
      height: 60vh;
      border: none;
      border-radius: 8px;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
      touch-action: manipulation;
      -webkit-overflow-scrolling: touch;
    }
    .error-message, .warning-message, .hint-text {
      font-size: 13px;
      color: var(--secondary-text);
      margin: 10px 0;
    }
    #tool-camera-simulator .camera-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    @media (orientation: landscape) {
      #tool-camera-simulator .camera-container {
        flex-direction: row;
      }
      #tool-camera-simulator .camera-container canvas, #tool-camera-simulator .camera-container video {
        width: 50%;
      }
    }
    #orientation-note {
      font-size: 13px;
      color: var(--secondary-text);
      margin-top: 10px;
      background: var(--bg-color);
      padding: 8px;
      border-radius: 8px;
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
    }
    #tool-color-picker .video-container {
      position: relative;
      width: 100%;
      overflow: hidden;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 3px 3px 6px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      border: 4px solid var(--accent-color);
    }
    #tool-color-picker #canvas-color.fixed {
      position: absolute;
      top: 0;
      left: 0;
    }
    #tool-color-picker .magnifier-canvas {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 10;
    }
    #tool-picture-simulator .drop-area {
      border: 2px dashed var(--secondary-text);
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-color);
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
    }
    #tool-picture-simulator .drop-area:hover, .drop-area.active {
      border-color: var(--primary-color);
      background: var(--accent-color);
    }
    #tool-picture-simulator .sample-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      justify-items: center;
      margin-bottom: 15px;
    }
    #tool-picture-simulator .sample-img {
      width: 80px;
      height: auto;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    }
    #tool-picture-simulator .sample-img:hover, .sample-img:focus {
      border: 2px solid var(--primary-color);
      transform: scale(1.1);
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
    }
    .quizContainer {
      background: var(--bg-color);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      margin-top: 50px;
    }
    .quizContainer .bar {
      background: var(--accent-color);
      border-radius: 15px;
      height: 8px;
      margin: 10px 0;
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
    }
    .quizContainer #childbar-ishihara, .quizContainer #childbar-hrr {
      background: var(--primary-color);
      height: 100%;
      border-radius: 15px;
      transition: width 0.3s ease;
    }
    .quizContainer ul li {
      list-style: none;
      margin: 10px 0;
    }
    .quizContainer label {
      cursor: pointer;
      padding: 8px 14px;
      background: var(--bg-color);
      border-radius: 20px;
      box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
      transition: all 0.3s ease;
      color: var(--text-color);
    }
    .quizContainer input[type="radio"]:checked + label {
      background: linear-gradient(145deg, var(--bg-color), var(--accent-color));
      color: var(--primary-color);
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
    }
    #optionContainer-ishihara, #optionContainer-hrr {
      display: none;
    }
    #quiz-ishihara, #quiz-hrr {
      display: block;
    }
    #fullscreen-prompt, #a2hs-prompt {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #fullscreen-prompt .prompt-container, #a2hs-prompt .prompt-container {
      background: var(--bg-color);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      max-width: 300px;
    }
    #fullscreen-prompt h2, #a2hs-prompt h2 {
      font-size: 18px;
      margin-bottom: 15px;
      color: var(--text-color);
    }
    #fullscreen-prompt button, #a2hs-prompt button {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      margin: 5px 0;
    }
    #a2hs-prompt p {
      font-size: 14px;
      color: var(--secondary-text);
      margin-bottom: 15px;
    }
    /* CSS برای فیلترهای SVG و iOS */
    #filterDiv-website {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .filter-protanopia {
      filter: url(#protanopia);
      -webkit-filter: url(#protanopia);
    }
    .filter-deuteranopia {
      filter: url(#deuteranopia);
      -webkit-filter: url(#deuteranopia);
    }
    .filter-tritanopia {
      filter: url(#tritanopia);
      -webkit-filter: url(#tritanopia);
    }
    .filter-achromatopsia {
      filter: url(#achromatopsia);
      -webkit-filter: url(#achromatopsia);
    }
    .ios-filter-protanopia {
      filter: url(#protanopia);
      -webkit-filter: grayscale(0%) contrast(1);
    }
    .ios-filter-deuteranopia {
      filter: url(#deuteranopia);
      -webkit-filter: grayscale(0%) contrast(1);
    }
    .ios-filter-tritanopia {
      filter: url(#tritanopia);
      -webkit-filter: grayscale(0%) contrast(1);
    }
    .ios-filter-achromatopsia {
      filter: grayscale(1) contrast(1.2);
      -webkit-filter: grayscale(1) contrast(1.2);
    }
    @media (max-width: 480px) {
      #app-home { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px 0 10px 0; }
      .app-icon { padding: 15px; height: 100px; }
      .app-icon i { font-size: 36px; }
      .app-icon span { font-size: 13px; }
      .container { padding: 15px; margin: 10px auto; }
      .back-btn, button { padding: 8px 15px; font-size: 13px; }
      h1, h2 { font-size: 20px; }
      iframe { height: 50vh; }
      #fullscreen-prompt .prompt-container, #a2hs-prompt .prompt-container { max-width: 80%; }
      .container,
      .quizContainer {
        margin-right: 10px;
        margin-left: 10px;
      }
      .back-btn {
        margin-right: 10px;
        margin-left: 10px;
      }
    }
    @media (min-width: 481px) and (max-width: 1024px) {
      .container { max-width: 95%; }
      iframe { height: 55vh; }
    }
  </style>
</head>
<body>
  <div id="fullscreen-prompt">
    <div class="prompt-container">
      <h2>برای تجربه بهتر، حالت تمام‌صفحه را فعال کنید</h2>
      <button onclick="enterFullscreen()">فعال کردن تمام‌صفحه</button>
      <button onclick="document.getElementById('fullscreen-prompt').style.display='none'">بعداً</button>
    </div>
  </div>
  <div id="a2hs-prompt" style="display: none;">
    <div class="prompt-container">
      <h2>اضافه کردن به صفحه اصلی</h2>
      <p>برای دسترسی سریع‌تر، این اپلیکیشن را به صفحه اصلی گوشی خود اضافه کنید:<br>1. روی دکمه Share در مرورگر (کروم یا سافاری) بزنید.<br>2. گزینه "Add to Home Screen" را انتخاب کنید.</p>
      <button onclick="closeA2HSPrompt()">متوجه شدم</button>
    </div>
  </div>
  <div id="app-home">
    <div class="app-icon" onclick="openTool('camera-simulator')">
      <i class="fas fa-camera"></i>
      <span>شبیه‌ساز با دوربین</span>
    </div>
    <div class="app-icon" onclick="openTool('picture-simulator')">
      <i class="fas fa-image"></i>
      <span>شبیه‌ساز تصاویر</span>
    </div>
    <div class="app-icon" onclick="openTool('website-simulator')">
      <i class="fas fa-globe"></i>
      <span>شبیه‌ساز وبسایت</span>
    </div>
    <div class="app-icon" onclick="openTool('color-picker')">
      <i class="fas fa-eye-dropper"></i>
      <span>تشخیص رنگ</span>
    </div>
    <div class="app-icon" onclick="openTool('ishihara-test')">
      <i class="fas fa-eye"></i>
      <span>تست ایشی هارا</span>
    </div>
    <div class="app-icon" onclick="openTool('hrr-test')">
      <i class="fas fa-shapes"></i>
      <span>تست HRR</span>
    </div>
  </div>

  <div id="tool-camera-simulator" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="container">
      <h2>شبیه‌ساز کوررنگی</h2>
      <div class="camera-container">
        <video id="video-camera-real" autoplay playsinline style="display: none;"></video>
        <canvas id="canvas-camera-real"></canvas>
        <video id="video-camera" autoplay playsinline style="display: none;"></video>
        <canvas id="canvas-camera"></canvas>
      </div>
      <p id="orientation-note">اگر گوشی را به حالت افقی بچرخانید، تصویر واقعی (چپ) و شبیه‌سازی‌شده (راست) کنار هم نمایش داده می‌شوند. در حالت عمودی فقط تصویر شبیه‌سازی‌شده نشان داده می‌شود.</p>
      <div id="controls-camera" class="controls">
        <div class="modes">
          <label><input type="radio" name="mode-camera" value="none" checked><span>عادی</span></label>
          <label><input type="radio" name="mode-camera" value="protan"><span>کوررنگی قرمز</span></label>
          <label><input type="radio" name="mode-camera" value="deutan"><span>کوررنگی سبز</span></label>
          <label><input type="radio" name="mode-camera" value="tritan"><span>کوررنگی آبی</span></label>
          <label><input type="radio" name="mode-camera" value="achroma"><span>کوررنگی کامل</span></label>
        </div>
        <label for="intensity-camera">شدت:</label>
        <input type="range" id="intensity-camera" min="0" max="1" step="0.01" value="1">
        <button id="switchCamera-camera" title="تعویض دوربین">
          <i class="fas fa-camera-rotate"></i>
        </button>
        <button id="startCamera-camera" title="شروع دوربین">
          <i class="fas fa-video"></i>
        </button>
      </div>
    </div>
  </div>

  <div id="tool-picture-simulator" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="container">
      <h1>شبیه‌ساز کوررنگی</h1>
      <div class="sample-images">
        <div id="dropArea-picture" class="drop-area">
          تصویر را اینجا بکشید یا کلیک کنید
          <input type="file" id="imageLoader-picture" accept="image/*" aria-label="انتخاب تصویر برای شبیه‌سازی کوررنگی" style="display: none;" />
        </div>
        <p>یا یکی از تصاویر زیر را انتخاب کنید:</p>
        <div class="sample-list">
          <img class="sample-img" src="https://www.koorrangi.ir/wp-content/uploads/2023/07/9-45-n-n.jpg" alt="نمونه 1" data-src="https://www.koorrangi.ir/wp-content/uploads/2023/07/9-45-n-n.jpg" tabindex="0">
          <img class="sample-img" src="https://www.koorrangi.ir/wp-content/uploads/2023/07/17-42-protanS2M42-deutanS4M42.jpg" alt="نمونه 2" data-src="https://www.koorrangi.ir/wp-content/uploads/2023/07/17-42-protanS2M42-deutanS4M42.jpg" tabindex="0">
          <img class="sample-img" src="https://www.koorrangi.ir/wp-content/uploads/2025/07/001191fc-4fdb-4f0e-8bb8-4a079a7e8f6a.jpg" alt="نمونه 3" data-src="https://www.koorrangi.ir/wp-content/uploads/2025/07/001191fc-4fdb-4f0e-8bb8-4a079a7e8f6a.jpg" tabindex="0">
          <img class="sample-img" src="https://www.koorrangi.ir/wp-content/uploads/2025/07/0775ad42-b2fb-4bb3-9a42-b59f00e01356.jpg" alt="نمونه 4" data-src="https://www.koorrangi.ir/wp-content/uploads/2025/07/0775ad42-b2fb-4bb3-9a42-b59f00e01356.jpg" tabindex="0">
          <img class="sample-img" src="https://www.koorrangi.ir/wp-content/uploads/2025/07/72e00a5b-644b-4960-9e5c-7d90a71a9919.jpg" alt="نمونه 5" data-src="https://www.koorrangi.ir/wp-content/uploads/2025/07/72e00a5b-644b-4960-9e5c-7d90a71a9919.jpg" tabindex="0">
        </div>
      </div>
      <div class="modes">
        <label><input type="radio" name="mode-picture" value="normal" checked><span>دید نرمال</span></label>
        <label><input type="radio" name="mode-picture" value="protanopia"><span>کوررنگی قرمز</span></label>
        <label><input type="radio" name="mode-picture" value="deuteranopia"><span>کوررنگی سبز</span></label>
        <label><input type="radio" name="mode-picture" value="tritanopia"><span>کوررنگی آبی</span></label>
        <label><input type="radio" name="mode-picture" value="achromatopsia"><span>کوررنگی کامل</span></label>
      </div>
      <div class="intensity-control">
        <label for="intensity-picture">شدت شبیه‌سازی: <span id="intensityValue-picture">100%</span></label>
        <input type="range" id="intensity-picture" min="0" max="1" step="0.1" value="1" aria-label="تنظیم شدت شبیه‌سازی کوررنگی">
      </div>
      <p class="hint-text">برای دیدن تصویر اصلی، انگشت خود را روی تصویر نگه دارید (یا با موس کلیک کنید)</p>
      <canvas id="mainCanvas-picture"></canvas>
      <button id="downloadBtn-picture" aria-label="دانلود تصویر شبیه‌سازی شده">دانلود تصویر <i class="fas fa-download"></i></button>
      <p class="hint-text">دانلود در موبایل فقط برای تصاویر کمتر از ۲ مگابایت</p>
      <div id="loading-picture" style="display: none;">در حال بارگذاری...</div>
    </div>
  </div>

  <div id="tool-website-simulator" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="container">
      <h2>شبیه‌ساز کوررنگی وبسایت</h2>
      <div class="controls">
        <input type="text" id="urlInput-website" placeholder="آدرس صفحه را وارد کنید (مثال: google.com)" aria-label="آدرس وبسایت">
        <button id="loadBtn-website" aria-label="بارگذاری وبسایت">بارگذاری</button>
      </div>
      <div class="modes" role="radiogroup" aria-label="حالت‌های شبیه‌سازی کوررنگی">
        <label><input type="radio" name="mode-website" value="" checked><span>عادی</span></label>
        <label><input type="radio" name="mode-website" value="protanopia"><span>کوررنگی قرمز</span></label>
        <label><input type="radio" name="mode-website" value="deuteranopia"><span>کوررنگی سبز</span></label>
        <label><input type="radio" name="mode-website" value="tritanopia"><span>کوررنگی آبی</span></label>
        <label><input type="radio" name="mode-website" value="achromatopsia"><span>کوررنگی کامل</span></label>
      </div>
      <div id="iframeContainer-website">
        <div id="filterDiv-website">
          <iframe id="simFrame-website" src="about:blank" title="پیش‌نمایش وبسایت با شبیه‌سازی کوررنگی"></iframe>
        </div>
      </div>
      <div id="loading-website" style="display: none;">
        <div>در حال بارگذاری...</div>
        <div style="margin-top: 10px; font-size: 14px;">لطفاً کمی صبر کنید</div>
      </div>
      <div class="warning-message" style="display: none;">
        اگر سایت باز نشد، لطفاً از سایت اسکرین‌شات بگیرید و در <a href="https://www.koorrangi.ir/%d8%b4%d8%a8%d9%8a%d9%87-%d8%b3%d8%a7%d8%b2-%da%a9%d9%88%d8%b1%d8%b1%d9%86%da%af%d9%8a/" target="_blank">صفحه شبیه‌ساز کوررنگی</a> استفاده کنید.
      </div>
      <svg width="0" height="0">
        <filter id="protanopia" color-interpolation-filters="sRGB">
          <feColorMatrix type="matrix" values="0.567 0.433 0 0 0 0.558 0.442 0 0 0 0 0 1 0 0 0 0 0 1 0"/>
        </filter>
        <filter id="deuteranopia" color-interpolation-filters="sRGB">
          <feColorMatrix type="matrix" values="0.625 0.375 0 0 0 0.7 0.3 0 0 0 0 0 1 0 0 0 0 0 1 0"/>
        </filter>
        <filter id="tritanopia" color-interpolation-filters="sRGB">
          <feColorMatrix type="matrix" values="0.95 0.05 0 0 0 0 0.433 0.567 0 0 0 0.475 0.525 0 0 0 0 0 1 0"/>
        </filter>
        <filter id="achromatopsia" color-interpolation-filters="sRGB">
          <feColorMatrix type="matrix" values="0.299 0.587 0.114 0 0 0.299 0.587 0.114 0 0 0.299 0.587 0.114 0 0 0 0 0 1 0"/>
        </filter>
      </svg>
    </div>
  </div>

  <div id="tool-color-picker" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="container">
      <!-- Camera Permission Modal -->
<div id="cameraPermissionModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
    <p class="text-gray-800 text-lg mb-4">برای استفاده از این ابزار، باید اجازه دسترسی به دوربین بدهید.</p>
    <button id="allowCameraBtn" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
      اجازه دسترسی
    </button>
  </div>
</div>
      <h2>تشخیص رنگ با دوربین</h2>
      <div id="videoContainer-color" class="video-container">
        <video id="video-color" autoplay playsinline class="absolute inset-0 w-full h-full object-cover"></video>
        <canvas id="canvas-color" class="absolute inset-0 w-full h-full" style="display: none;"></canvas>
        <canvas id="magnifierCanvas-color" class="magnifier-canvas"></canvas>
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
          <div class="w-6 h-6 border-2 border-white rounded-full"></div>
        </div>
      </div>
      <div id="controls-color" class="controls">
        <div class="flex flex-col items-center">
          <label for="brightnessSlider-color" class="text-sm font-semibold mb-2 text-[var(--text-color)]">روشنایی</label>
          <input type="range" id="brightnessSlider-color" min="0.5" max="2.0" step="0.1" value="1.0" aria-label="تنظیم روشنایی تصویر">
        </div>
        <button id="zoomOutBtn-color" title="کوچک‌نمایی">
          <i class="fas fa-search-minus"></i>
        </button>
        <button id="zoomInBtn-color" title="بزرگ‌نمایی">
          <i class="fas fa-search-plus"></i>
        </button>
        <button id="switchCameraBtn-color" title="تعویض دوربین">
          <i class="fas fa-camera-rotate"></i>
        </button>
        <button id="pauseResumeBtn-color" title="توقف/ادامه">
          <i id="pauseResumeIcon-color" class="fas fa-pause"></i>
        </button>
        <button id="playColorBtn-color" title="پخش نام رنگ">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
      <div id="colorInfo-color" class="text-center p-4 rounded-lg shadow-inner bg-[var(--bg-color)]">
        <p class="text-lg mb-2">
          <span class="font-bold">رنگ: </span>
          <span id="colorName-color" class="text-[var(--primary-color)]">در انتظار...</span>
        </p>
        <p class="text-lg mb-2">
          <span class="font-bold">کد هگز: </span>
          <span id="hexCode-color" class="font-mono text-[var(--primary-color)]">-</span>
        </p>
        <p class="text-lg mb-4">
          <span class="font-bold">کد RGB: </span>
          <span id="rgbCode-color" class="font-mono text-[var(--primary-color)]">-</span>
        </p>
        <div id="colorBox-color" class="w-16 h-16 mx-auto border border-[var(--accent-color)] rounded-full shadow-inner"></div>
      </div>
      <div id="messageModal-color" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-[var(--bg-color)] rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
          <p id="modalMessage-color" class="text-lg mb-4 text-[var(--text-color)]"></p>
          <button id="closeModalBtn-color" class="bg-[var(--bg-color)] text-[var(--text-color)] font-semibold py-2 px-4 rounded-lg hover:bg-[var(--accent-color)] transition-colors">بستن</button>
        </div>
      </div>
    </div>
  </div>

  <div id="tool-ishihara-test" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="quizContainer" id="quiz-ishihara">
      <h1>تست کوررنگی ایشی هارا</h1>
      <img id="mamad-ishihara" class="mamad" width="400" height="400" onload="nowShowPicIshihara()"></img>
      <h1 id="progressbarnumber-ishihara"></h1>
      <div class="bar">
        <div id="childbar-ishihara"></div>
      </div>
      <h3>سوال‌ها</h3>
      <ul id="nowShowPic-ishihara" style="display:none;">
        <li><input type="radio" id="a-ishihara" name="answer-ishihara" class="answer" /><label id="option1-ishihara" for="a-ishihara"></label></li>
        <li><input type="radio" id="b-ishihara" name="answer-ishihara" class="answer" /><label id="option2-ishihara" for="b-ishihara"></label></li>
        <li><input type="radio" id="c-ishihara" name="answer-ishihara" class="answer" /><label id="option3-ishihara" for="c-ishihara"></label></li>
        <li><input type="radio" id="d-ishihara" name="answer-ishihara" class="answer" /><label id="option4-ishihara" for="d-ishihara">هیچکدام</label></li>
      </ul>
      <div class="btn">
        <button id="btn-reset-ishihara" style="display: none">تست مجدد</button>
        <button id="btn-next-ishihara" style="display: none">بعدی</button>
      </div>
    </div>
  </div>

  <div id="tool-hrr-test" class="tool-page">
    <button class="back-btn" onclick="closeTool()">برگشت</button>
    <div class="quizContainer" id="quiz-hrr">
      <h1>تست کوررنگی HRR</h1>
      <img id="mamad-hrr" class="mamad" width="400" height="400" onload="nowShowPicHrr()"></img>
      <h1 id="progressbarnumber-hrr"></h1>
      <div class="bar">
        <div id="childbar-hrr"></div>
      </div>
      <h3>سوال‌ها</h3>
      <ul id="nowShowPic-hrr" style="display:none;">
        <li><input type="radio" id="a-hrr" name="answer-hrr" class="answer" /><label id="option1-hrr" for="a-hrr"></label></li>
        <li><input type="radio" id="b-hrr" name="answer-hrr" class="answer" /><label id="option2-hrr" for="b-hrr"></label></li>
        <li><input type="radio" id="c-hrr" name="answer-hrr" class="answer" /><label id="option3-hrr" for="c-hrr"></label></li>
        <li><input type="radio" id="d-hrr" name="answer-hrr" class="answer" /><label id="option4-hrr" for="d-hrr">هیچکدام</label></li>
      </ul>
      <div class="btn">
        <button id="btn-reset-hrr" style="display: none">تست مجدد</button>
        <button id="btn-next-hrr" style="display: none">بعدی</button>
      </div>
    </div>
  </div>

  <button id="add-to-home" style="display: none;">اضافه به صفحه اصلی</button>
  <div id="install-instructions" style="display: none;">
    برای اضافه کردن به صفحه اصلی: در مرورگر، منوی Share را باز کنید و "Add to Home Screen" را انتخاب کنید.
    <br>
    <button id="dismiss-a2hs">بعداً نشان بده</button>
  </div>

  <script>
    function enterFullscreen() {
      const elem = document.documentElement;
      try {
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
      } catch (e) {
        console.error('Fullscreen error:', e);
      }
      document.getElementById('fullscreen-prompt').style.display = 'none';
    }

    function closeA2HSPrompt() {
      localStorage.setItem('a2hsShown', 'true');
      document.getElementById('a2hs-prompt').style.display = 'none';
    }

    window.onload = function() {
      if (!localStorage.getItem('a2hsShown')) {
        document.getElementById('a2hs-prompt').style.display = 'flex';
      }
    };
  </script>
  <script src="js/main.js"></script>
  <script src="js/camera-simulator.js"></script>
  <script src="js/picture-simulator.js"></script>
  <script src="js/website-simulator.js"></script>
  <script src="js/color-picker.js"></script>
  <script src="js/ishihara-test.js"></script>
  <script src="js/hrr-test.js"></script>
</body>
</html>